# Домашнее задание к занятию «Конфигурация приложений»

### Цель задания

В тестовой среде Kubernetes необходимо создать конфигурацию и продемонстрировать работу приложения.

------

### Чеклист готовности к домашнему заданию

1. Установленное K8s-решение (например, MicroK8s).
2. Установленный локальный kubectl.
3. Редактор YAML-файлов с подключённым GitHub-репозиторием.

------

### Инструменты и дополнительные материалы, которые пригодятся для выполнения задания

1. [Описание](https://kubernetes.io/docs/concepts/configuration/secret/) Secret.
2. [Описание](https://kubernetes.io/docs/concepts/configuration/configmap/) ConfigMap.
3. [Описание](https://github.com/wbitt/Network-MultiTool) Multitool.

------

### Задание 1. Создать Deployment приложения и решить возникшую проблему с помощью ConfigMap. Добавить веб-страницу

1. Создать Deployment приложения, состоящего из контейнеров nginx и multitool.
2. Решить возникшую проблему с помощью ConfigMap.
3. Продемонстрировать, что pod стартовал и оба конейнера работают.
4. Сделать простую веб-страницу и подключить её к Nginx с помощью ConfigMap. Подключить Service и показать вывод curl или в браузере.
5. Предоставить манифесты, а также скриншоты или вывод необходимых команд.

------
### Ответ 1.
![1](https://github.com/alibok86/kuber-homeworks/blob/main/2.3/1.png)


cfgmap.yml

```
apiVersion: v1
kind: ConfigMap
metadata:
  name: my-configmap
data:
  default.conf: |
    server {
        listen 8080;
        server_name _;
        
        location / {
            root /usr/share/nginx/html;
            index index.html index.htm;
        }
        
        location /health {
            return 200 "healthy\n";
            add_header Content-Type text/plain;
        }
    }
  index.html: |
    <html>
    <head><title>Netology</title></head>
    <body style="font-family:sans-serif;text-align:center;margin-top:40px">
      <h1>Hello to Netology</span>!</h1>
    </body>
    </html>
```

deploy.yml
```
apiVersion: apps/v1
kind: Deployment
metadata:
  name: multitool
  labels:
    app: multitool
spec:
  replicas: 1
  selector:
    matchLabels:
      app: multitool
  template:
    metadata:
      labels:
        app: multitool
    spec:
      containers:
      - name: multitool
        image: wbitt/network-multitool:latest
        volumeMounts:
        - mountPath: /etc/config/multitool
          name: configmap-volume

      - name: nginx
        image: nginx:latest
        ports:
        - containerPort: 8080
        volumeMounts:
        - name: configmap-volume
          mountPath: /etc/nginx/conf.d/default.conf
          subPath: default.conf
        - name: configmap-index
          mountPath: /usr/share/nginx/html/index.html
          subPath: index.html

      volumes:
      - name: configmap-volume
        configMap:
          name: my-configmap
          items:
          - key: default.conf
            path: default.conf

      - name: configmap-index
        configMap:
          name: my-configmap
          items:
          - key: index.html
            path: index.html        
```

service.yml
```
apiVersion: v1
kind: Service
metadata:
  name: nginx-svc
spec:
  selector:
    app: multitool
  ports:
    - protocol: TCP
      port: 8080
      targetPort: 8080
  type: NodePort
```

### Задание 2. Создать приложение с вашей веб-страницей, доступной по HTTPS 

1. Создать Deployment приложения, состоящего из Nginx.
2. Создать собственную веб-страницу и подключить её как ConfigMap к приложению.
3. Выпустить самоподписной сертификат SSL. Создать Secret для использования сертификата.
4. Создать Ingress и необходимый Service, подключить к нему SSL в вид. Продемонстировать доступ к приложению по HTTPS. 
4. Предоставить манифесты, а также скриншоты или вывод необходимых команд.

------
### Ответ 2.
![1](https://github.com/alibok86/kuber-homeworks/blob/main/2.3/2.png)

cfgmap.yml

```
apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx-conf
data:
  index.html: |
    <html>
    <head><title>Netology</title></head>
    <body style="font-family:sans-serif;text-align:center;margin-top:40px">
      <h1>Hello to Netology</span>!</h1>
    </body>
    </html>
  default.conf: |
    server {
      listen       80;
      listen       443 ssl;
      server_name  netology.local;
      
      ssl_certificate     /etc/nginx/ssl/tls.crt;
      ssl_certificate_key /etc/nginx/ssl/tls.key;
      
      location / {
        root   /usr/share/nginx/html;
        index  index.html;
      }
    }
```

deploy.yml
```
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deploy
spec:
  replicas: 1
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
        - name: nginx
          image: nginx:latest
          ports:
            - containerPort: 80
            - containerPort: 443
          volumeMounts:
            - name: html
              mountPath: /usr/share/nginx/html
            - name: tls
              mountPath: /etc/nginx/ssl
              readOnly: true
            - name: config
              mountPath: /etc/nginx/conf.d/default.conf
              subPath: default.conf
      volumes:
        - name: html
          configMap:
            name: nginx-conf
        - name: tls
          secret:
            secretName: nginx-tls
        - name: config
          configMap:
            name: nginx-conf     
```

service.yml
```
apiVersion: v1
kind: Service
metadata:
  name: nginx-svc
spec:
  selector:
    app: nginx
  ports:
    - name: http
      port: 80
      targetPort: 80
    - name: https
      port: 443
      targetPort: 443
  type: ClusterIP
```

secret.yml
```
apiVersion: v1
kind: Secret
metadata:
  name: nginx-tls
type: kubernetes.io/tls
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURPVENDQWlHZ0F3SUJBZ0lVTEVQV3VKMXFaQkRxRzZ0YjlXa1ZvK21QVXYwd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0xERVhNQlVHQTFVRUF3d09ibVYwYjJ4dloza3ViRzlqWVd3eEVUQVBCZ05WQkFvTUNHNWxkRzlzYjJkNQpNQjRYRFRJMU1URXhNREF6TWpNMU1Wb1hEVEkyTVRFeE1EQXpNak0xTVZvd0xERVhNQlVHQTFVRUF3d09ibVYwCmIyeHZaM2t1Ykc5allXd3hFVEFQQmdOVkJBb01DRzVsZEc5c2IyZDVNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUYKQUFPQ0FROEFNSUlCQ2dLQ0FRRUF3OGpXOTB5dEJBMHlTa3JWanBwRGxFYk15SjRtZFE4cUhJUDN5YTdFSGVGWQp1cnFYUnY1T3B0STdvclNYUCttbElUci9rNzQ0WFdwYm5WZ2VCVzFPdjcrTVgxRXIrdjhVOXp4eWY5SXBoVXROCnNmTVVFZVRsMlRVUGNFaWUxMHYxcm13aERpNllCejg0SUh1V2lRcXJjWW1LN0FTQnA2eHgvZnNrUDJvNEhqTXIKMkxyaC9ZYjNDVmNVK2pKYkxyb3VNaTBuMjA0VzZXT3ByeENFeWM4WW1Db1pCOW5Id0Y0S0MrdGUwdjdESDFFeQpwNHdzQTk0OXBORWNYR3Viei9jV0dmZFEvcnk2MWVlMjJXQ1E1dUhvTUhaNkdWU2lSWXdsbHNGSjdtZ0ZVRnMzCjVyRG51Tnc0dHQ0azgxeGN2N1kvWTVORWxpb21WRjJYMXpUUEJHYndRd0lEQVFBQm8xTXdVVEFkQmdOVkhRNEUKRmdRVXUvb0FCZVVER3Q1UjUzMkV5UzNZMmNpOWptb3dId1lEVlIwakJCZ3dGb0FVdS9vQUJlVURHdDVSNTMyRQp5UzNZMmNpOWptb3dEd1lEVlIwVEFRSC9CQVV3QXdFQi96QU5CZ2txaGtpRzl3MEJBUXNGQUFPQ0FRRUF2bTBuClFvak5vVWc0SGNpdWVyNUUxWUlOWVh6QUhCYjNrVHhtTEMyT1NNT2dqWkg2QmlCUm5pWWlVSkxBUVhGMnBPL3MKY2NzS3I5TGNZVCtqalNzQjRWU1dQUUQxZ0k0TTExN1lQTWxWd01td3ZIY2tkUkVnUjRidFVpbjhnVm9oYjVETwpOODg0NEorWTdsSjRQNmJuQVVXOXRKbDFvakFnQll3VVV6SVRYNkFFNmNPK21JVnFCTXpudDJ0aVRwSTJUbmVpCktxMzdaKzl4QUxaVVN4Z2doaEI1aTBMSiswS0dYSVVxNWtxMUdiWjNYVDE1NDlsYUgxOVY2em1aYmthMk1zRWoKUVl4MHhMWDltNDY0VG81aVBjd1VhUlpZY1RUdDBwZHJ1bCtibzF2Y1ZIMG56ZkVSV2tucFdOZmhPbkw3ZXZvTApFTlpTQkRMeGtUVDI1QmUwRnc9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
  tls.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2Z0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktnd2dnU2tBZ0VBQW9JQkFRRER5TmIzVEswRURUSksKU3RXT21rT1VSc3pJbmlaMUR5b2NnL2ZKcnNRZDRWaTZ1cGRHL2s2bTBqdWl0SmMvNmFVaE92K1R2amhkYWx1ZApXQjRGYlU2L3Y0eGZVU3Y2L3hUM1BISi8waW1GUzAyeDh4UVI1T1haTlE5d1NKN1hTL1d1YkNFT0xwZ0hQemdnCmU1YUpDcXR4aVlyc0JJR25ySEg5K3lRL2FqZ2VNeXZZdXVIOWh2Y0pWeFQ2TWxzdXVpNHlMU2ZiVGhicFk2bXYKRUlUSnp4aVlLaGtIMmNmQVhnb0w2MTdTL3NNZlVUS25qQ3dEM2oyazBSeGNhNXZQOXhZWjkxRCt2THJWNTdiWgpZSkRtNGVnd2Rub1pWS0pGakNXV3dVbnVhQVZRV3pmbXNPZTQzRGkyM2lUelhGeS90ajlqazBTV0tpWlVYWmZYCk5NOEVadkJEQWdNQkFBRUNnZ0VBRm0wa0NwSFM0N3JyUHMxUnB4TU9tS1ovZ0o5MUFrV3BhampIb21lTmVXcTkKc2kzN2RCdGZRUWFsNUI1UmtQV2ZmNjMxWnFRTWFzN3JEWnZ4WEdmSDlIanBpR1dRNXlCZTgyOE9Jb3dkUzNKegp4T1YyTUJLTExaVkJYbmhERWFCVzFSTDN1bHNsK1BhSjVGYWp5TERiTUpjenZaTktrcjFURldlMklEbDNraVhRCjU2dm9ZTkZIZkxBa041Qi9aSDQwN1Z3bjZzS1U3Y2FDcW45a3puLzRzdXdzTzAydEhXN0JkdWtPWi96R2JYc0MKcEY4ZVdSbUNRMTZoZDZVUXhrMHVqenNBTnpud2dUVkY1UDVWSDVxYytja1NYR2hZT042U1R5STBUNTVONnU5bApjT2RRdnJHc1VNclVMMWp3b09aQ2NmcFJmSndYMGsxT3hRTVRqNUNUK1FLQmdRRDFZUWxNSXhoZ1BXaUJjeE0yCmdHTysweFViRDA1M3ZIZnRybXpXL0RwQWFHR1ZlQTZiRkg2VDBoK09VZTZzOW5uZTNLODUxZFh1VUNXOEFCcS8KYmgvbG0wS2dLWEsvVDBsU3hrbnFnTmYwcXc0dmI2MG9zSHVoeTIyNWp2V285TVNrQUQ1NnFMa3owR3B4MkJyNwpjWVJYc1lkOG0zRXF4RXFsRHRtSUl1UDRUUUtCZ1FETVFrTlZZRzJ4S0g3LzJCOVpiN1R6T1AvdVIyVVZtUXF1CitiYjRVWWNZUkZuUXJ0eit6UmVZcmY4TzZJNENYemZVbEs4V3pDSEZkbVpDR21uZ2g3SGFYK1NmVEJmbGhuMXAKU0hNWVhqUmFqL0Z4WXJ1czkwaXNoWUROTG83clo4a3I2aHFwSmtuY1JQbjFRZU5jOGlpbTNFV1JQN2xwU2JmYwpYZmNSTHVyU3p3S0JnUUNaaGpqMjlnNU9TSjJXUUpXSXlCT2dWUmtqY1JRN1BpUWJCY0w3VDV4eXA5eEdWSE51Ci9BZW1IUlc1U2ZIM0xjOWFiT0VGWXBFVEpmbzJBaXE2RXdESis3WlgxeGNBTTI5QTV1ZGdYWFRBbERXdjRFT0sKN2NDc25rYnNqbEdOZ0hkMzFOOUNoMFk0OFBGb2dUbUFrS21vNUY1TXpFU2w2V0o2bXl2blRVMHRFUUtCZ0FPVQp3ZE4wWGxmMXlzdzNnTTB6blN1S2UwbzFMRHVGdEY4Kzk0dEErcXBkUUduZE52aXNwZFpDYnE5WE9tNG1OemRkCjUvZnhXa0k1QWkvMGdKaTBLRlVZeTB4VHJET1UrUXZvZmtRV0dycmZ2UzdzdVRlZUdrTVVFQjhJeXU2cm9pWkgKODNHMXZ5UENmZE5qOVZXQzFWMmZqUVN2NWxOSFBKYjdlc0p0WFNhWEFvR0JBSjlxeDdua2VheUVhOWVGa3hCLwovVWs1dWRKdVRDUDNIdU8vbEZRRGlDNWRrdTFHTlE1VWhlbFRDWENUYm9qK3RSL2duVnpaRTZseGJhUlZwb0k5CjZ4OUtCWFlWbkFCUXNOSWtzUFc2eFpteFA5aWg0dXJkdk50VXpDMGwyWS9MeHJFaUJQcWxkWnVraERSUUdHSncKZ2hHRnczdnFDdFB1ckMveVR1dVRKUTZNCi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K
```

ingress.yml

```
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: nginx-ingress
  annotations:
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/backend-protocol: "HTTPS"
spec:
  ingressClassName: nginx
  tls:
    - hosts:
        - netology.local
      secretName: nginx-tls
  rules:
    - host: netology.local
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: nginx-svc
                port:
                  number: 443
```

### Правила приёма работы

1. Домашняя работа оформляется в своём GitHub-репозитории в файле README.md. Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.
2. Файл README.md должен содержать скриншоты вывода необходимых команд `kubectl`, а также скриншоты результатов.
3. Репозиторий должен содержать тексты манифестов или ссылки на них в файле README.md.

------
